<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mix Recipes</title>
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <style>
    .recipe-card {
      background: var(--card-bg);
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }
    .recipe-card img {
      width: 36px;
      height: 36px;
      align-self: flex-end;
    }
    .toggle-btns {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .toggle-btns button {
      flex: 1 1 45%;
    }
    .editable-note {
      width: 100%;
      min-height: 60px;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid var(--primary);
      background: var(--bg-light);
      color: var(--text-dark);
      resize: vertical;
    }
    .footer-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
      max-width: 700px;
      margin: 1rem auto;
    }
    @media (min-width: 600px) {
      .footer-buttons {
        flex-direction: row;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
  <div id="header-container"></div>

  <main class="container" id="recipeContainer"></main>

  <div class="footer-buttons">
    <button class="btn" onclick="createCustomRecipe()">➕ Custom Recipe</button>
    <button class="btn" onclick="window.location.href='index.html'">⬅ Return</button>
  </div>

  <script src="header.js"></script>
  <script>
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-container').innerHTML = data;
      })
      .catch(error => console.error("Error loading header:", error));

    const STORAGE_KEY = "customNotes";
    let customNotes = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");

    const recipes = [
      {
        name: "Terracotta Roof",
        icon: "icons/terracotta.png",
        safe: { sh: 3, surf: 0.005, scent: 0, note: "Maintenance wash for tile roofs." },
        heavy: { sh: 5.5, surf: 0.005, scent: 0.002, note: "For thick lichen or mould." }
      },
      {
        name: "Colorbond Roof",
        icon: "icons/colorbond.png",
        safe: { sh: 2, surf: 0.01, scent: 0, note: "Routine wash on painted metal." },
        heavy: { sh: 4.5, surf: 0.005, scent: 0.002, note: "Mossy or grime-heavy roofs." }
      },
      {
        name: "Concrete / Driveway",
        icon: "icons/concrete.png",
        safe: { sh: 2.5, surf: 0.01, scent: 0, note: "General surface cleaning." },
        heavy: { sh: 4.5, surf: 0.01, scent: 0, note: "Lichen, stains or moss removal." }
      },
      {
        name: "Painted Wall",
        icon: "icons/painted.png",
        safe: { sh: 1.5, surf: 0.015, scent: 0.001, note: "Annual house wash." },
        heavy: { sh: 3, surf: 0.01, scent: 0.002, note: "Heavy grime, oxidation or mildew." }
      },
      {
        name: "Timber Deck",
        icon: "icons/timber.png",
        safe: { sh: 0.75, surf: 0.02, scent: 0.001, note: "Gentle clean to protect wood." },
        heavy: { sh: 1.5, surf: 0.015, scent: 0.002, note: "For blackened timber or grime." }
      },
      {
        name: "Freshly Painted Surface",
        icon: "icons/freshpaint.png",
        safe: {
          sh: 0,
          surf: 0.015,
          scent: 0.001,
          note: "Avoid SH where possible. Gentle surfactant rinse only. Do not allow to dwell."
        },
        heavy: {
          sh: 0.5,
          surf: 0.015,
          scent: 0.002,
          note: "SH must be used with extreme caution. Rinse quickly. Always test a small area first."
        }
      }
    ];

    const container = document.getElementById("recipeContainer");

    recipes.forEach((r, index) => {
      const card = document.createElement("div");
      card.className = "recipe-card";

      card.innerHTML = `
        <img src="${r.icon}" alt="icon">
        <h3>${r.name}</h3>
        <div class="toggle-btns">
          <button onclick="toggleMode(${index}, 'safe')" id="safe-${index}" class="active">Safe</button>
          <button onclick="toggleMode(${index}, 'heavy')" id="heavy-${index}">Heavy</button>
        </div>
        <div id="details-${index}"></div>
        <textarea class="editable-note" id="note-${index}" oninput="saveNote(${index})" placeholder="Add your own tips or reminders here..."></textarea>
        <button class="btn" onclick="applyRecipe(${index})">Use This Mix</button>
      `;

      container.appendChild(card);
      updateDetails(index, 'safe');
    });

    function toggleMode(index, mode) {
      document.getElementById(`safe-${index}`).classList.remove('active');
      document.getElementById(`heavy-${index}`).classList.remove('active');
      document.getElementById(`${mode}-${index}`).classList.add('active');
      updateDetails(index, mode);
    }

    function updateDetails(index, mode) {
      const recipe = recipes[index][mode];
      const key = `${index}-${mode}`;
      document.getElementById(`details-${index}`).innerHTML = `
        <p><strong>SH:</strong> ${recipe.sh}%<br>
        <strong>Surfactant:</strong> ${recipe.surf ? `1:${Math.round(1/recipe.surf)}` : "none"}<br>
        <strong>Scent:</strong> ${recipe.scent ? `1:${Math.round(1/recipe.scent)}` : "none"}</p>
      `;
      document.getElementById(`note-${index}`).value = customNotes[key] || recipe.note;
    }

    function saveNote(index) {
      const isHeavy = document.getElementById(`heavy-${index}`).classList.contains('active');
      const mode = isHeavy ? 'heavy' : 'safe';
      const key = `${index}-${mode}`;
      const value = document.getElementById(`note-${index}`).value;
      customNotes[key] = value;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(customNotes));
    }

    function applyRecipe(index) {
      const isHeavy = document.getElementById(`heavy-${index}`).classList.contains('active');
      const selected = recipes[index][isHeavy ? 'heavy' : 'safe'];
      localStorage.setItem("presetMix", JSON.stringify(selected));
      alert("Mix applied! Returning to main calculator...");
      window.location.href = "index.html";
    }

    function createCustomRecipe() {
      const custom = prompt("Enter SH%, Surfactant, Scent (comma-separated):", "2.5,0.01,0.001");
      if (!custom) return;
      const parts = custom.split(',').map(x => parseFloat(x));
      if (parts.length !== 3 || parts.some(isNaN)) return alert("Invalid input.");
      const [sh, surf, scent] = parts;
      localStorage.setItem("presetMix", JSON.stringify({ sh, surf, scent }));
      alert("Custom mix applied! Returning to main calculator...");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
